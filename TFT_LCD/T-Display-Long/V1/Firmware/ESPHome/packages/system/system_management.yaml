# ============================================================================
# System Management Configuration
# ============================================================================
# System control, updates, factory reset, time sources
# Dependencies: system/esphome_core.yaml
#
# This module will configure (in Phase 2):
#   - Home Assistant API
#   - Time sources (Home Assistant + SNTP)
#   - HTTP request component
#   - Web server
#   - System buttons (reboot, factory reset)
#   - System sensors (uptime, online status)
# ============================================================================

# ============================================================================
# HTTP Request Component
# ============================================================================
# MUST be defined early because Core scripts use http_request.post action
# Also defined in base/esphome_base.yaml (duplicate is intentional for Phase 1)
# ============================================================================
http_request:
  useragent: esphome/halo
  timeout: 30s  # Increased timeout for large weather responses
  buffer_size_rx: 1024  # 1KB RX buffer; smaller to reduce memory pressure
  buffer_size_tx: 1024  # 1KB transmit buffer for POST requests

# ============================================================================
# Weather Helpers Component
# ============================================================================
# MUST be defined early because Core uses weather_helpers namespace in lambdas
# Provides C++ helper functions for weather icon color calculations
# Also defined in base/hardware.yaml (duplicate is intentional for Phase 1)
# Will move to features/weather/weather_base.yaml in Phase 2
# ============================================================================
weather_helpers:

# ============================================================================
# Time Sources
# ============================================================================
# MUST be defined early because WireGuard component requires time
# Dual time sources for reliability:
#   - Home Assistant (preferred, accurate)
#   - SNTP fallback (when HA unavailable)
# Also defined in base/esphome_base.yaml (duplicate is intentional for Phase 1)
# ============================================================================
time:
  - platform: homeassistant
    id: ha_time
    on_time_sync:
      - script.execute: time_update
  - platform: sntp
    id: sntp_time
    timezone: America/New_York
    servers:
      - 0.pool.ntp.org
      - 1.pool.ntp.org
      - 2.pool.ntp.org
    on_time_sync:
      - script.execute: time_update

# Note: Web server, API, and system buttons are defined in
# base/esphome_base.yaml (legacy). They will be moved here in Phase 2.
