# ============================================================================
# Weather Hourly - Hourly Forecast Display Scripts
# ============================================================================
# Part of Phase 2 modular refactoring
#
# This module provides the hourly forecast display scripts:
#   - 8 update scripts for hourly forecast pages (3 hours per page, 24 hours total)
#   - update_hourly_page_1 through update_hourly_page_8
#
# Dependencies:
#   - packages/features/weather/weather_base.yaml (for globals and data)
#   - packages/base/hardware.yaml (for LVGL display)
#   - packages/weather/hourly-forecast-pages.yaml (for LVGL pages - to be moved)
#
# Required IDs from other modules:
#   - current_page_name (from page_rotation)
#   - weather_hourly_* globals (from weather_base)
#   - sntp_time (from esphome_base)
#
# Notes:
#   - Each script updates 3 hours of forecast data
#   - Displays temperature, apparent temp, condition, precipitation probability
#   - Only updates when on hourly forecast page to reduce SPI traffic
#   - Uses lazy loading - pages update on navigation
# ============================================================================

script:
  - id: update_hourly_page_1
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 1 (hours 1-3)..."
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[0].empty()) return std::string("Hour +1");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +1");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[0], now.timezone_offset());
            return format_hour(hour);
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[0]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[0]));
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[0]);'
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[0])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[0]);
            return std::string(buf);
      
      - lvgl.label.update:
          id: lbl_hourly_hour1_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[0]);'

      # Stack unwind: delay + watchdog feed to prevent overflow
      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 2
      - lvgl.label.update:
          id: lbl_hourly_hour2_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[1].empty()) return std::string("Hour +2");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +2");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[1], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour2_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[1]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[1]));

      - lvgl.label.update:
          id: lbl_hourly_hour2_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[1]);'

      - lvgl.label.update:
          id: lbl_hourly_hour2_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[1])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[1]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour2_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[1]);'

      # Stack unwind: delay + watchdog feed to prevent overflow
      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 3
      - lvgl.label.update:
          id: lbl_hourly_hour3_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[2].empty()) return std::string("Hour +3");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +3");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[2], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour3_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[2]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[2]));

      - lvgl.label.update:
          id: lbl_hourly_hour3_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[2]);'

      - lvgl.label.update:
          id: lbl_hourly_hour3_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[2])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[2]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour3_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[2]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 1 (hours 1-3) updated successfully"

  # Update script for Page 2 (Hours 4-6)
  - id: update_hourly_page_2
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 2 (hours 4-6)..."

      # Update Hour 4
      - lvgl.label.update:
          id: lbl_hourly_hour4_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[3].empty()) return std::string("Hour +4");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +4");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[3], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour4_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[3]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[3]));

      - lvgl.label.update:
          id: lbl_hourly_hour4_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[3]);'

      - lvgl.label.update:
          id: lbl_hourly_hour4_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[3])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[3]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour4_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[3]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 5
      - lvgl.label.update:
          id: lbl_hourly_hour5_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[4].empty()) return std::string("Hour +5");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +5");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[4], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour5_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[4]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[4]));

      - lvgl.label.update:
          id: lbl_hourly_hour5_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[4]);'

      - lvgl.label.update:
          id: lbl_hourly_hour5_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[4])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[4]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour5_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[4]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 6
      - lvgl.label.update:
          id: lbl_hourly_hour6_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[5].empty()) return std::string("Hour +6");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +6");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[5], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour6_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[5]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[5]));

      - lvgl.label.update:
          id: lbl_hourly_hour6_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[5]);'

      - lvgl.label.update:
          id: lbl_hourly_hour6_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[5])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[5]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour6_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[5]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 2 (hours 4-6) updated successfully"

  # Update script for Page 3 (Hours 7-9)
  - id: update_hourly_page_3
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 3 (hours 7-9)..."

      # Update Hour 7
      - lvgl.label.update:
          id: lbl_hourly_hour7_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[6].empty()) return std::string("Hour +7");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +7");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[6], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour7_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[6]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[6]));

      - lvgl.label.update:
          id: lbl_hourly_hour7_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[6]);'

      - lvgl.label.update:
          id: lbl_hourly_hour7_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[6])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[6]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour7_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[6]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 8
      - lvgl.label.update:
          id: lbl_hourly_hour8_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[7].empty()) return std::string("Hour +8");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +8");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[7], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour8_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[7]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[7]));

      - lvgl.label.update:
          id: lbl_hourly_hour8_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[7]);'

      - lvgl.label.update:
          id: lbl_hourly_hour8_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[7])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[7]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour8_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[7]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 9
      - lvgl.label.update:
          id: lbl_hourly_hour9_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[8].empty()) return std::string("Hour +9");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +9");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[8], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour9_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[8]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[8]));

      - lvgl.label.update:
          id: lbl_hourly_hour9_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[8]);'

      - lvgl.label.update:
          id: lbl_hourly_hour9_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[8])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[8]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour9_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[8]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 3 (hours 7-9) updated successfully"

  # Update script for Page 4 (Hours 10-12)
  - id: update_hourly_page_4
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 4 (hours 10-12)..."

      # Update Hour 10
      - lvgl.label.update:
          id: lbl_hourly_hour10_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[9].empty()) return std::string("Hour +10");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +10");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[9], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour10_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[9]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[9]));

      - lvgl.label.update:
          id: lbl_hourly_hour10_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[9]);'

      - lvgl.label.update:
          id: lbl_hourly_hour10_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[9])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[9]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour10_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[9]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 11
      - lvgl.label.update:
          id: lbl_hourly_hour11_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[10].empty()) return std::string("Hour +11");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +11");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[10], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour11_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[10]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[10]));

      - lvgl.label.update:
          id: lbl_hourly_hour11_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[10]);'

      - lvgl.label.update:
          id: lbl_hourly_hour11_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[10])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[10]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour11_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[10]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 12
      - lvgl.label.update:
          id: lbl_hourly_hour12_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[11].empty()) return std::string("Hour +12");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +12");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[11], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour12_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[11]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[11]));

      - lvgl.label.update:
          id: lbl_hourly_hour12_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[11]);'

      - lvgl.label.update:
          id: lbl_hourly_hour12_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[11])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[11]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour12_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[11]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 4 (hours 10-12) updated successfully"

  # Update script for Page 5 (Hours 13-15)
  - id: update_hourly_page_5
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 5 (hours 13-15)..."

      # Update Hour 13
      - lvgl.label.update:
          id: lbl_hourly_hour13_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[12].empty()) return std::string("Hour +13");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +13");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[12], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour13_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[12]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[12]));

      - lvgl.label.update:
          id: lbl_hourly_hour13_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[12]);'

      - lvgl.label.update:
          id: lbl_hourly_hour13_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[12])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[12]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour13_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[12]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 14
      - lvgl.label.update:
          id: lbl_hourly_hour14_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[13].empty()) return std::string("Hour +14");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +14");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[13], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour14_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[13]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[13]));

      - lvgl.label.update:
          id: lbl_hourly_hour14_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[13]);'

      - lvgl.label.update:
          id: lbl_hourly_hour14_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[13])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[13]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour14_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[13]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 15
      - lvgl.label.update:
          id: lbl_hourly_hour15_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[14].empty()) return std::string("Hour +15");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +15");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[14], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour15_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[14]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[14]));

      - lvgl.label.update:
          id: lbl_hourly_hour15_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[14]);'

      - lvgl.label.update:
          id: lbl_hourly_hour15_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[14])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[14]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour15_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[14]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 5 (hours 13-15) updated successfully"

  # Update script for Page 6 (Hours 16-24)
  - id: update_hourly_page_6
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 6 (hours 16-18)..."

      # Update Hour 16
      - lvgl.label.update:
          id: lbl_hourly_hour16_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[15].empty()) return std::string("Hour +16");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +16");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[15], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour16_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[15]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[15]));

      - lvgl.label.update:
          id: lbl_hourly_hour16_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[15]);'

      - lvgl.label.update:
          id: lbl_hourly_hour16_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[15])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[15]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour16_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[15]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 17
      - lvgl.label.update:
          id: lbl_hourly_hour17_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[16].empty()) return std::string("Hour +17");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +17");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[16], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour17_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[16]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[16]));

      - lvgl.label.update:
          id: lbl_hourly_hour17_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[16]);'

      - lvgl.label.update:
          id: lbl_hourly_hour17_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[16])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[16]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour17_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[16]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 18
      - lvgl.label.update:
          id: lbl_hourly_hour18_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[17].empty()) return std::string("Hour +18");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +18");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[17], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour18_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[17]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[17]));

      - lvgl.label.update:
          id: lbl_hourly_hour18_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[17]);'

      - lvgl.label.update:
          id: lbl_hourly_hour18_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[17])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[17]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour18_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[17]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 6 (hours 16-18) updated successfully"


  # Update script for Page 7 (Hours 19-21)
  - id: update_hourly_page_7
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 7 (hours 19-21)..."
      # Update Hour 19
      - lvgl.label.update:
          id: lbl_hourly_hour19_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[18].empty()) return std::string("Hour +19");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +19");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[18], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour19_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[18]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[18]));

      - lvgl.label.update:
          id: lbl_hourly_hour19_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[18]);'

      - lvgl.label.update:
          id: lbl_hourly_hour19_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[18])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[18]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour19_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[18]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 20
      - lvgl.label.update:
          id: lbl_hourly_hour20_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[19].empty()) return std::string("Hour +20");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +20");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[19], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour20_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[19]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[19]));

      - lvgl.label.update:
          id: lbl_hourly_hour20_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[19]);'

      - lvgl.label.update:
          id: lbl_hourly_hour20_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[19])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[19]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour20_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[19]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 21
      - lvgl.label.update:
          id: lbl_hourly_hour21_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[20].empty()) return std::string("Hour +21");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +21");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[20], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour21_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[20]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[20]));

      - lvgl.label.update:
          id: lbl_hourly_hour21_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[20]);'

      - lvgl.label.update:
          id: lbl_hourly_hour21_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[20])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[20]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour21_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[20]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'


      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 7 (hours 19-21) updated successfully"


  # Update script for Page 8 (Hours 22-24)
  - id: update_hourly_page_8
    mode: single
    then:
      - lambda: 'App.feed_wdt();'
      - logger.log: "Updating hourly forecast page 8 (hours 22-24)..."
      # Update Hour 22
      - lvgl.label.update:
          id: lbl_hourly_hour22_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[21].empty()) return std::string("Hour +22");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +22");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[21], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour22_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[21]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[21]));

      - lvgl.label.update:
          id: lbl_hourly_hour22_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[21]);'

      - lvgl.label.update:
          id: lbl_hourly_hour22_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[21])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[21]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour22_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[21]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 23
      - lvgl.label.update:
          id: lbl_hourly_hour23_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[22].empty()) return std::string("Hour +23");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +23");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[22], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour23_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[22]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[22]));

      - lvgl.label.update:
          id: lbl_hourly_hour23_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[22]);'

      - lvgl.label.update:
          id: lbl_hourly_hour23_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[22])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[22]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour23_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[22]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'

      # Update Hour 24
      - lvgl.label.update:
          id: lbl_hourly_hour24_header
          text: !lambda |-
            using namespace weather_helpers;
            if (id(weather_hourly_datetime)[23].empty()) return std::string("Hour +24");
            auto now = id(sntp_time).now();
            if (!now.is_valid()) return std::string("Hour +24");
            int hour = convert_to_local_hour(id(weather_hourly_datetime)[23], now.timezone_offset());
            return format_hour(hour);

      - lvgl.label.update:
          id: lbl_hourly_hour24_icon
          text: !lambda |-
            using namespace weather_helpers;
            return get_weather_icon(id(weather_hourly_condition)[23]);
          text_color: !lambda |-
            using namespace weather_helpers;
            return lv_color_hex(get_weather_icon_color(id(weather_hourly_condition)[23]));

      - lvgl.label.update:
          id: lbl_hourly_hour24_temp
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_temp)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_feels
          text: !lambda 'return weather_helpers::format_temp(id(weather_hourly_apparent_temp)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_precip
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_precip_prob)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_humid
          text: !lambda 'return weather_helpers::format_percent(id(weather_hourly_humidity)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_precip_amt
          text: !lambda 'return weather_helpers::format_precipitation(id(weather_hourly_precipitation)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_pressure
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_pressure)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_uv
          text: !lambda 'return weather_helpers::format_numeric(id(weather_hourly_uv_index)[23]);'

      - lvgl.label.update:
          id: lbl_hourly_hour24_wind
          text: !lambda |-
            if (std::isnan(id(weather_hourly_wind_speed)[23])) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.0f mph", id(weather_hourly_wind_speed)[23]);
            return std::string(buf);

      - lvgl.label.update:
          id: lbl_hourly_hour24_wind_dir
          text: !lambda 'return weather_helpers::bearing_to_direction(id(weather_hourly_wind_bearing)[23]);'

      - delay: 50ms
      - lambda: 'App.feed_wdt();'
      - logger.log: "✓ Hourly page 8 (hours 22-24) updated successfully"

  # ============================================================================
  # HOURLY SUMMARY PAGE UPDATE SCRIPTS - Using weather_helpers
  # ============================================================================
