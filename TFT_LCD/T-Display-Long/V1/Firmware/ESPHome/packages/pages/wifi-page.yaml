# ============================================================================
# WiFi & VPN Status Page Module
# ============================================================================
# Network status and diagnostics display
#
# Dependencies:
#   - base/globals.yaml (current_page_name, wifi_signal_needs_render, wifi_ssid_needs_render, etc.)
#   - Hardware: Display, touchscreen, WiFi hardware
#   - Scripts: page_transition_cleanup (in Core)
#   - Substitutions: version
#
# Features:
#   - WiFi network SSID display
#   - Signal strength indicator with visual bar
#   - IP address display
#   - WireGuard VPN status
#   - VPN IP address
#   - VPN endpoint information
#   - Last handshake time
#   - Home Assistant connection status icon
#   - Firmware version display
#   - Navigation touch button
# ============================================================================

# ============================================================================
# LVGL Pages - WiFi & VPN Status
# ============================================================================
lvgl:
  pages:
    # ------------------------------------------------------------------------
    # WiFi & VPN Status Page
    # ------------------------------------------------------------------------
    # Network diagnostics and connection status
    # Shows WiFi strength, IP addresses, VPN status
    # Displays Home Assistant connectivity
    # ------------------------------------------------------------------------
    - id: wifi_page
      bg_color: 0x000000
      bg_opa: COVER
      scrollbar_mode: "OFF"
      on_load:
        - script.execute: page_transition_cleanup
        - lambda: 'id(current_page_name) = "wifi";'
        # Trigger immediate WiFi display updates when page loads
        - lambda: |-
            id(wifi_signal_needs_render) = true;
            id(wifi_signal_bar_needs_render) = true;
            id(wifi_ssid_needs_render) = true;
            id(wifi_ip_needs_render) = true;
            id(ha_status_needs_render) = true;
            id(wg_status_needs_render) = true;
            id(wg_address_needs_render) = true;
            id(wg_handshake_needs_render) = true;
      widgets:
        - label:
            text: "WiFi & VPN \nStatistics"
            align: CENTER
            x: 0
            y: -300
            text_font: montserrat_20
            text_color: my_white
            text_align: CENTER
        - label:
            id: wifi_ssid_label
            text: "SSID: ...\n"
            align: LEFT_MID
            x: 10
            y: -250
            text_font: montserrat_18
            text_color: my_white
        - label:
            id: wifi_signal_label
            text: "Signal: ..."
            align: LEFT_MID
            x: 10
            y: -230
            text_font: montserrat_18
            text_color: my_white
        - bar:
            id: wifi_signal_bar
            align: CENTER
            x: 0
            y: -200
            width: 160
            height: 10
            min_value: -100
            max_value: -30
            value: -100
            bg_color: my_gray
            indicator:
              bg_grad: wifi_signal_gradient

        - label:
            id: wifi_ip_label
            text: "IP: ..."
            align: LEFT_MID
            x: 10
            y: -175
            text_font: montserrat_18
            text_color: my_white
        - label:
            text: "WireGuard"
            align: CENTER
            x: 0
            y: -100
            text_font: montserrat_20
            text_color: my_teal
        - label:
            id: wg_status_label
            text: "Status: Disabled"
            align: LEFT_MID
            x: 10
            y: -50
            text_font: montserrat_18
            text_color: my_gray
        - label:
            id: wg_address_label
            text: "VPN IP: ..."
            align: LEFT_MID
            x: 10
            y: 0
            text_font: montserrat_18
            text_color: my_white
        - label:
            id: wg_endpoint_label
            text: "Endpoint: ..."
            align: LEFT_MID
            x: 10
            y: 50
            text_font: montserrat_18
            text_color: my_white
        - label:
            id: wg_handshake_label
            text: "Last Handshake: ..."
            align: LEFT_MID
            x: 10
            y: 125
            text_font: montserrat_18
            text_color: my_white
            text_align: LEFT

        # Version number label
        - label:
            text: "${version}"
            align: BOTTOM_MID
            x: 0
            y: -5
            text_font: montserrat_14
            text_color: my_gray

        # Home Assistant connection status icon
        - label:
            id: ha_status_icon
            text: "\U000F07D0"  # Home Assistant icon (MDI)
            align: BOTTOM_MID
            x: 0
            y: -40
            text_font: icons_80
            text_color: my_gray  # Will be updated based on connection status

        - obj:
            id: nav_button_wifi
            align: TOP_RIGHT
            x: 0
            y: 0
            width: 180
            height: 150
            bg_opa: 0
            border_width: 0
            clickable: true
            on_release:
              - logger.log: "WiFi page nav button RELEASED!"
              - lambda: |-
                  ESP_LOGI("touch", "Navigation button touched");
                  id(last_auto_rotation_time) = millis();
                  ESP_LOGD("touch", "Auto-rotation timer reset");
              - lvgl.page.next:
                  animation: OUT_LEFT
                  time: 300ms
